<!DOCTYPE html><html dir="ltr" lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="ie=edge" http-equiv="X-UA-Compatible"><link href="/manifest.json" rel="manifest"><style>.article--content{margin:0 auto;max-width:calc(80ch + 4rem);padding:2rem}@font-face{font-display:swap;font-family:aller;font-style:normal;font-weight:700;src:url(/fonts/aller/regular.woff2) format("woff2"),url(/fonts/aller/regular.woff) format("woff")}@font-face{font-display:swap;font-family:aller;font-style:italic;font-weight:700;src:url(/fonts/aller/italic.woff2) format("woff2"),url(/fonts/aller/italic.woff) format("woff")}@font-face{font-display:swap;font-family:aller;font-style:normal;font-weight:400;src:url(/fonts/aller/light.woff2) format("woff2"),url(/fonts/aller/light.woff) format("woff")}@font-face{font-display:swap;font-family:aller;font-style:italic;font-weight:400;src:url(/fonts/aller/light-italic.woff2) format("woff2"),url(/fonts/aller/light-italic.woff) format("woff")}:root{--blue-600:#1a73e8;--yellow-200:#fde293;--green-300:#81c995;--grey-900:#202124;--grey-500:#9aa0a6;--grey-100:#f1f3f4;--grey-50:#f8f9fa;--orange-300:#fcad70;--pink-500:#f439a0;--purple-200:#d7aefb;--cyan-400:#4ecde6;--red:#c20030;--black:#202124;--white:#fff}body,h1,html,p{margin:0;padding:0}article,header{display:block}h1{font-size:100%;font-weight:400}html{box-sizing:border-box}*,::after,::before{box-sizing:inherit}:root{font-family:aller,sans-serif;font-size:100%;letter-spacing:.03125em;line-height:1.5}body :not(script)+*{margin-top:1em}a{color:#c20030}h1{font-family:inherit;line-height:1}h1{font-size:6rem;letter-spacing:-.015625em}html{height:100%}body{background-color:#f8f7f2;display:grid;grid-template-rows:1fr auto;min-height:100%}.article--heading{--paint-alpha:.2;--base-hue:25;--max-saturation:30;--max-lightness:80;--size:125;background-color:hsl(var(--base-hue),100%,30%);background-image:paint(triangles);align-items:center;background-image:paint(triangles),linear-gradient(to bottom right,#c20030,#da9400);border-bottom:.5px solid rgba(0,0,0,var(--paint-alpha));box-sizing:border-box;color:var(--white);display:flex;flex-wrap:wrap;font-weight:700;height:57.14286vh;justify-content:flex-end;text-align:right;text-rendering:optimizeLegibility}.article--title{text-shadow:0 -.005em #111,-.005em 0 #111,-.005em -.01em #111,-.01em -.005em #111,-.01em -.015em #111,-.015em -.01em #111,-.015em -.02em #111,-.02em -.015em #111,-.02em -.025em #111,-.025em -.02em #111,-.025em -.03em #111,-.03em -.025em #111,-.03em -.035em #111,-.035em -.03em #111,-.035em -.04em #111,-.04em -.035em #111,-.04em -.045em #111,-.045em -.04em #111,-.045em -.05em #111,-.05em -.045em #111,-.05em -.055em #111,-.055em -.05em #111,-.055em -.06em #111,-.06em -.055em #111,-.06em -.065em #111,-.065em -.06em #111,-.065em -.07em #111,-.07em -.065em #111,-.07em -.075em #111,-.075em -.07em #111;font-size:calc(2em + 6vw);font-weight:700;padding:2rem;word-wrap:break-word}.article--content{font-size:125%}</style><link href="/css/style.css" rel="stylesheet" media="print" onload="this.media='all'"><link href="/fonts/aller/light.woff2" rel="preload" type="font/woff2" as="font" crossorigin=""><link href="/fonts/aller/regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin=""><link href="/css/dank-mono.css" rel="stylesheet" media="print" onload="this.media='all'"><script defer="" src="/js/main.js" type="module"></script><link href="/images/icons/icon72.png" rel="icon" type="image/png"><link href="/images/icons/icon192.png" rel="apple-touch-icon"><meta content="#008673" name="theme-color"><title>Eleventy + Vite | Snugug</title><meta content="A pattern I've started using combining Eleventy and Vite.
" name="Description"><meta content="zIeV2B7zZKCtEFP-6vV8rKk0ocpbp035v_g3IRn12Jo" name="google-site-verification"></head><body><div class="_wrapper"><div class="_blog"><main class="_blog--article" itemscope="" itemtype="http://schema.org/Blog"><article class="article"><header class="article--heading"><h1 class="article--title" itemprop="name">Eleventy + Vite</h1></header><div class="article--content base" itemprop="text"><p>I really like <a href="https://www.11ty.dev/" rel="noopener">Eleventy</a> as a static site generator; it does all of the things I want from an SSG and it does it well. Well, except asset handling, like compiling, bundling, and managing my CSS and JavaScript. I think part of that is because setting up compilers and bundlers just is kinda an absolute drag, even if you know what you’re doing. Except, that is, with <a href="https://vitejs.dev/" rel="noopener">Vite</a>. Vite may just be the single best front-end development tool I’ve used in literal years. It’s fast, it’s got bells and whistles built-in, it’s smart and un-opinionated enough that there’s almost no overhead to get what you likely want, and it’s super extensible. Combining the two felt obvious.</p><p>Eleventy and Vite both take slightly different approaches to compiling; Eleventy, everything’s compiled up-front, whereas Vite things are compiled on-the-fly. Critically, because of this, Vite expects everything to be served from one folder, by default the top-level folder, but Eleventy expects things to be compiled to a folder for serving. While I"m sure someone could get super creative with a combination of Vite and or Eleventy plugins to make the workflow I’m about to show cleaner, this setup is fast, efficient, and will have you rolling with both of them quickly.</p><section><h2 id="configure-vite"><a href="#configure-vite" class="header-anchor">¶</a> Configure Vite</h2><p>First thing first, after installing Eleventy and Vite is to set up your Vite config. I’m going to assume that all of the working code is going to go into the <code>src</code> directory, so <code>src/js</code> for JavaScript, <code>src/css</code> for CSS, etc… and that the compiled output is going to go into the <code>public</code> directory. Switch these folders up as you need. To make this work from the Vite side, this is all you need in your <code>vite.config.js</code> file:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'vite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  root<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">,</span>
  clearScreen<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// This is to show Eleventy output in the console along with Vite output</span>
  build<span class="token operator">:</span> <span class="token punctuation">{</span>
    outDir<span class="token operator">:</span> <span class="token string">'../public'</span><span class="token punctuation">,</span> <span class="token comment">// The output directory is relative to the project root, so we need to put it back one folder to work</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>That’s it! It sets the root directory Vite works from to the <code>src</code> folder, it sets the build directory to a sibling of the <code>src</code> folder called <code>public</code>, and it configures the command line interface so that you can see Eleventy and Vite output at the same time.</p></section><section><h2 id="configure-eleventy"><a href="#configure-eleventy" class="header-anchor">¶</a> Configure Eleventy</h2><p>Next up is configuring Eleventy. Here, the only essential configuration is to change the output directory of Eleventy to Vite’s root directory; this ensures the HTML is available for Vite to serve. This will make that directory <em>a little messy</em> as all compiled HTML will get put in there, but for a quick and effective solution, I’m OK with it. To do so, make sure the following is set in your <code>.eleventy.js</code> file:</p><pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">eleventy</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    dir<span class="token operator">:</span> <span class="token punctuation">{</span>
      output<span class="token operator">:</span> <span class="token string">'src'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><p>Any other Eleventy config you want, you can put in there, too. Last thing you need to do to button this up is to add <code>src/**/*.html</code> to any ignore files you have (like <code>.gitignore</code>) so the in-development Eleventy compiled HTML is not included.</p></section><section><h2 id="add-npm-scripts"><a href="#add-npm-scripts" class="header-anchor">¶</a> Add NPM Scripts</h2><p>Two more steps! Almost done! This step is optional, but I highly recommend it: setting up NPM scripts to make working with all of this easier. My recommendation is to install the following dev dependencies:</p><pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i -D npm-run-all del-cli delete-empty
</code></pre><p>These three packages, will, in order, let you run NPM scripts sequentially or in parallel from other npm scripts, let you delete items, and let you delete empty folders. These three combine to make a few really handy scripts possible:</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"prestart"</span><span class="token operator">:</span> <span class="token string">"run-s clean"</span><span class="token punctuation">,</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"run-p *:dev"</span><span class="token punctuation">,</span>
    <span class="token property">"prebuild"</span><span class="token operator">:</span> <span class="token string">"run-s clean"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"NODE_ENV=production run-s eleventy:build vite:build"</span><span class="token punctuation">,</span>
    <span class="token property">"clean"</span><span class="token operator">:</span> <span class="token string">"run-s clean:files clean:empty"</span><span class="token punctuation">,</span>
    <span class="token property">"clean:files"</span><span class="token operator">:</span> <span class="token string">"del 'src/**/*.html' public"</span><span class="token punctuation">,</span>
    <span class="token property">"clean:empty"</span><span class="token operator">:</span> <span class="token string">"delete-empty src"</span><span class="token punctuation">,</span>
    <span class="token property">"eleventy:dev"</span><span class="token operator">:</span> <span class="token string">"eleventy --watch"</span><span class="token punctuation">,</span>
    <span class="token property">"eleventy:build"</span><span class="token operator">:</span> <span class="token string">"eleventy"</span><span class="token punctuation">,</span>
    <span class="token property">"vite:dev"</span><span class="token operator">:</span> <span class="token string">"vite"</span><span class="token punctuation">,</span>
    <span class="token property">"vite:build"</span><span class="token operator">:</span> <span class="token string">"vite build"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>These combine to give you, really, two scripts you’re likely to run: <code>npm start</code> and <code>npm run build</code>. They do the following:</p><dl><dt><code>npm start</code></dt><dd>Before start is run, it deletes all of the HTML files from the <code>src</code> directory and removes the <code>public</code> directory, then deletes empty folders in the <code>src</code> directory that may be left over fom removing the HTML files. Once done, it runs all of the NPM scripts ending in <code>:dev</code>, so <code>eleventy:dev</code> and <code>vite:dev</code>, in parallel, which starts Eleventy in watch mode and Vite in dev mode.</dd><dt><code>npm run build</code></dt><dd>This is run with <code>NODE_ENV=production</code>, or “in production mode”, which is a common signal that production optimizations should happen. Before build is run, it cleans up the files just like start did, then runs Eleventy’s build first, then Vite’s build second; this is to ensure that the HTML gets generated before Vite tries to do its thing with it.</dd></dl></section><section><h2 id="multi-page-apps-static-assets-and-vite"><a href="#multi-page-apps-static-assets-and-vite" class="header-anchor">¶</a> Multi-Page Apps, Static Assets, and Vite</h2><p>Vite, in development mode, work with multi-page apps just fine! Unfortunately, when it comes to build time, it only works on <code>src/index.html</code> by default. This is straightforward to remedy, though. First install <a href="https://www.npmjs.com/package/fast-glob" rel="noopener">Fast Glob</a> as a dev dependency (<code>npm i -D fast-glob</code>) and add the following to your <code>vite.config.js</code> file:</p><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> glob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fast-glob'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Find all HTML files and build an object of names and paths to work from</span>
<span class="token keyword">const</span> files <span class="token operator">=</span> glob<span class="token punctuation">.</span><span class="token method function property-access">sync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/**/*.html'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> cur<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/src/'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token string">'/index.html'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// If name is blank, make up a name for it, like 'home'</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    name <span class="token operator">=</span> <span class="token string">'home'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  acc<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> cur<span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> acc<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ... Other config stuff</span>
  build<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ... Other build config stuff</span>
    rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      input<span class="token operator">:</span> files<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>While a little complicated, what this does is find all of the HTML files in the <code>src</code> directory, figure out a name for the file by removing <code>/index.html</code>, and then building an array of names and HTML pages to use as input for Vite’s Rollup configuration. This assumes that all pages that get assets have a <code>/index.html</code> file; if not, update the glob or the replacement accordingly. This is also going to generate a JavaScript file for each page, but because of how Vite handles imports, you should still get shared chunks between all of them. This is kind of the ugliest bit of this setup, and I’m sure it can be improved, but it’s pretty good for a quick solve.</p><p>As for assets, like a <code>manifest.json</code>, <code>robots.txt</code>, or images, Vite expects those to be in a <code>public</code> folder in your root, so in this case, <code>src/public</code>. Usually not a big deal, but if you find those assets aren’t getting checked in, make sure you’re ignore files are ignoring <code>/public</code> for the roo public folder, not <code>public</code> which will ignore folders named public <em>anywhere</em>, including the one is <code>src</code>.</p></section><section><h2 id="whats-next"><a href="#whats-next" class="header-anchor">¶</a> What’s Next</h2><p>For me, this is a very happy little setup. I’m sure there’s more tweaking that can be done to make everything a bit more smooth and a bit easier to deal with, but this was the most minimal setup I could get to that consistently worked and, more importantly, gave me the awesome dev experience of the combined power of Vite and Eleventy. If you’ve got thoughts on this setup or this post, drop me a line on Twitter.</p><p>Enjoy y’all!</p></section><footer class="article--author"><span class="article--published" itemprop="datePublished">Published on <time datetime="Invalid Date">May 12, 2021</time></span></footer></div></article></main></div></div><!--#include virtual="/_components/nav.txt"--><footer class="footer"><nav><ul><li><a href="/">Home</a></li><li><a href="/me/">About Me</a></li><li><a href="/cookbook/">Cookbook</a></li><li><a href="/musings/">Musings</a></li><li><a href="/presentations/">Presentations</a></li></ul></nav></footer><!--#endinclude--><script>(function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        (i[r] =
          i[r] ||
          function() {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-30577396-1', 'auto');
      ga('send', 'pageview');</script><noscript><link href="/css/style.css" rel="stylesheet"></noscript><noscript><link href="/css/dank-mono.css" rel="stylesheet" media="print" onload="this.media='all'"></noscript></body></html>