<!DOCTYPE html>
<html lang="en" class="astro-MPDYEVQB">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="stylesheet" href="/fonts/dank-mono.css">
    <link rel="me" href="https://mas.to/@snugug">
    <link rel="manifest" href="/manifest.webmanifest">
    <meta name="generator" content="Astro v1.6.15">
    <title>Image Based Art Direction with CSS Container Queries | Snugug</title>
    <meta name="description" content="How to art direct images with container queries, no JavaScript required.">
  <link rel="stylesheet" href="/assets/cookbook.afd1d160.css" />
<link rel="stylesheet" href="/assets/cookbook.65b8ab6f.css" />
<link rel="stylesheet" href="/assets/_slug_.b6836d49.css" /></head>
  <body class="body astro-MPDYEVQB">
    <style>astro-island,astro-slot{display:contents}</style><script>(self.Astro=self.Astro||{}).load=a=>{(async()=>await(await a())())()},window.dispatchEvent(new Event("astro:load"));var l;{const c={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},o=(t,s)=>{if(t===""||!Array.isArray(s))return s;const[e,n]=s;return e in c?c[e](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(l=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{if(!this.hydrator||this.parentElement&&this.parentElement.closest("astro-island[ssr]"))return;const s=this.querySelectorAll("astro-slot"),e={},n=this.querySelectorAll("template[data-astro-template]");for(const r of n){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(const r of s){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("name")||"default"]=r.innerHTML)}const a=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,a,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((s,e)=>{e.disconnect(),this.childrenConnectedCallback()}).observe(this,{childList:!0})}async childrenConnectedCallback(){window.addEventListener("astro:hydrate",this.hydrate);let s=this.getAttribute("before-hydration-url");s&&await import(s),this.start()}start(){const s=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(Astro[e]===void 0){window.addEventListener(`astro:${e}`,()=>this.start(),{once:!0});return}Astro[e](async()=>{const n=this.getAttribute("renderer-url"),[a,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(const d of i.split("."))this.Component=this.Component[d]}return this.hydrator=r,this.hydrate},s,this)}attributeChangedCallback(){this.hydrator&&this.hydrate()}},l.observedAttributes=["props"],l))}</script><astro-island uid="ZJ6d3u" component-url="/Menu.ecc8f48d.js" component-export="default" renderer-url="/client.05ab6769.js" props="{&quot;class&quot;:[0,&quot;astro-MPDYEVQB&quot;]}" ssr="" client="load" opts="{&quot;name&quot;:&quot;Menu&quot;,&quot;value&quot;:true}" await-children=""><div><button class="toggle svelte-lkm16t" aria-expanded="false" aria-label="Open menu"></button>

  <nav class="menu svelte-lkm16t" aria-expanded="false"><ul class="menu--list svelte-lkm16t"><li><a href="/" tabindex="-1">Home</a></li>
      <li><a href="/musings" tabindex="-1">Posts</a></li>
      <li><a href="/cookbook" tabindex="-1">Cookbook</a></li>
      <li><a href="/me" tabindex="-1">About</a></li>
      <li><a href="/presentations" tabindex="-1">Presentations</a></li>
      <li><a href="/rss.xml" tabindex="-1">RSS</a></li></ul></nav>
</div></astro-island>

    <div class="body-content astro-MPDYEVQB">
      <main itemscope="" itemtype="http://schema.org/Blog" class="astro-HRZLV7RA">
    <article class="article astro-HRZLV7RA">
      <header class="article--heading astro-HRZLV7RA">
        <div class="heading heading--padded astro-O3TATT2D" style="--hue: 25;--saturation: 30;--lightness: 80;--alpha: 0.2;--size: 125;">
  <h1 class="heading--title astro-O3TATT2D" itemprop="name">Image Based Art Direction with CSS Container Queries</h1>
</div>


      </header>
      <div class="article--container astro-HRZLV7RA">
        <div class="article--inner astro-HRZLV7RA">
          <p class="article--date astro-HRZLV7RA">
            
            <time datetime="2023-01-06T00:00:00.000Z" class="astro-HRZLV7RA">1/6/2023
            </time>
          </p>
          <div class="article--content type astro-HRZLV7RA"><p>I’ve just started a refactor of some code for ChromeOS.dev and I’m starting with a tricky component that I’m looking to refactor into using <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Container_Queries">container queries</a>. This component has a <code>&lt;picture&gt;</code> element in it that uses media queries for art direction. Works great now, but part of this refactor is going from 3 separate components that all basically do the same thing to one single, container query based one, so that media query needs to go. So I started digging in.</p>
<p>I found Sara Soueidan’s wonderful <a href="https://www.sarasoueidan.com/blog/component-level-art-direction-with-container-queries-and-picture/">Component-level art direction with CSS Container Queries</a> post which mentions this, but sadly doesn’t have an answer other than bumping the images to CSS. Ten I came across the <a href="https://github.com/w3c/csswg-drafts/issues/5889"><code>srcset</code> and <code>sizes</code> interaction with container queries</a> issue from Una in the CSS Working Group drafts. Reading through that article, it got me thinking, and I think I’ve got a workable, if lightly bad for above-the-fold performance solution that requires 0 JavaScript.</p>
<p>Thanks to wonderful work by Tim Kadlec, we’ve known since 2012 that <a href="https://timkadlec.com/2012/04/media-query-asset-downloading-results/"><code>display: none</code> images still get downloaded by browsers</a>. This is because browsers try and eagerly download images before styling and layout has occurred to improve loading performance. But, something we didn’t have then, but we do have now, is built-in support for lazy loading via <code>loading=&quot;lazy&quot;</code> attribute on images.</p>
<p>I put together a <a href="https://codepen.io/Snugug/pen/VwBmqQQ">quick CodePen proof of concept</a> based on comments in the CSSWG issue and, sure enough,in Chrome anyway, a lazy loaded image won’t download if display is <code>none</code>. And just like that, a solution emerged.</p>
<p>Now, the reason this isn’t great for performance is it will delay image loading, so <a href="https://web.dev/lcp/">largest contentful paint</a> may suffer, so <code>&lt;picture&gt;</code> elements are probably better most of the time. That said, if you need container based image art direction, here’s how you do it:</p>
<ol>
<li>Add <code>loading=&quot;lazy&quot;</code> to lazy load the desired images, one image per “art direction”</li>
<li><code>display: none</code> the images that need to be art directed</li>
<li>Use container queries to undo <code>display: none</code> (with <code>block</code> for instance).</li>
</ol>
<p>That’s it! No JavaScript,only a couple of straightforward lines of CSS. Here’s the example from the CodePen:</p>
<figure><pre class="language-scss"><code class="language-scss"><span class="token comment">// Hide the image tags</span>
<span class="token selector">img </span><span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Set the container to track inline size</span>
<span class="token selector">.container </span><span class="token punctuation">{</span>
  <span class="token property">container-type</span><span class="token punctuation">:</span> inline-size<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">%</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Make the first image block initially, then none at the desired width</span>
<span class="token selector">.pic-1 </span><span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>

  <span class="token atrule"><span class="token rule">@container</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> <span class="token number">700</span><span class="token unit">px</span><span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Make the second image block at the desired width</span>
<span class="token selector">.pic-2 </span><span class="token punctuation">{</span>
  <span class="token atrule"><span class="token rule">@container</span> <span class="token punctuation">(</span><span class="token property">min-width</span><span class="token punctuation">:</span> <span class="token number">700</span><span class="token unit">px</span><span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> initial<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></figure><p>That’s it! Go have fun with it!</p>
</div>
        </div>
      </div>
    </article>
  </main>
    </div>

    <script>(self.Astro=self.Astro||{}).only=t=>{(async()=>await(await t())())()},window.dispatchEvent(new Event("astro:only"));</script><astro-island uid="1HCVf6" component-url="/Scripts.e7e8b989.js" component-export="default" renderer-url="/client.05ab6769.js" props="{&quot;class&quot;:[0,&quot;astro-MPDYEVQB&quot;]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;Scripts&quot;,&quot;value&quot;:true}"></astro-island>
    <footer class="footer svelte-1bt7hha"><div class="inner svelte-1bt7hha"><img src="/images/me/square.jpg" alt="Headshot of Sam" class="headshot svelte-1bt7hha" loading="lazy">
    <h2 class="svelte-1bt7hha">Sam <br><span class="aka">aka</span>
      <a class="type--a svelte-1bt7hha" href="/links">Snugug</a></h2>
    <p class="svelte-1bt7hha">BBQ lead, ChromeOS DevRel</p>
    <p class="svelte-1bt7hha">Web, design, development, food</p></div>
</footer>
  
</body></html>

